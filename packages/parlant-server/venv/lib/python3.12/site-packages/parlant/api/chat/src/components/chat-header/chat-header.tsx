import { type ReactNode, useEffect, useState } from 'react'
import { useAtom } from 'jotai'
import { Menu } from 'lucide-react'
import { agentAtom, dialogAtom, sessionAtom } from '@/store'
import { spaceClick } from '@/utils/methods'
import AgentList from '../agents-list/agent-list'
import HeaderWrapper from '../header-wrapper/header-wrapper'
import SessionList from '../session-list/session-list'
import Tooltip from '../ui/custom/tooltip'
import { Input } from '../ui/input'
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from '../ui/sheet'
// import DarkModeToggle from '../dark-mode-toggle/dark-mode-toggle';

export const NEW_SESSION_ID = 'NEW_SESSION'

const ChatHeader = ({
  setFilterSessionVal,
  filterSessionVal,
}: {
  setFilterSessionVal: (value: string) => void
  filterSessionVal: string
}): ReactNode => {
  const [sheetOpen, setSheetOpen] = useState(false)
  const [session, setSession] = useAtom(sessionAtom)
  const [, setAgent] = useAtom(agentAtom)
  const [dialog] = useAtom(dialogAtom)

  useEffect(() => {
    if (sheetOpen) setSheetOpen(false)
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [session])

  const createNewSession = () => {
    setSession(null)
    setAgent(null)
    dialog.openDialog('', <AgentList />, { height: '536px', width: '604px' })
  }

  return (
    <HeaderWrapper className='z-60 overflow-visible rounded-s-[16px] '>
      <div className='boder-b-[0.6px] flex h-[70px] w-[352px] items-center rounded-ss-[16px] rounded-se-[16px] border-b-[#ebecf0] bg-white max-mobile:w-full max-mobile:justify-between'>
        <div className='flex items-center min-[801px]:hidden'>
          <div className='flex items-center'>
            <img src='/chat/app-logo.svg' alt='logo' aria-hidden className='h-[30px] self-center' />
          </div>
          <div>
            <Sheet open={sheetOpen} onOpenChange={() => setSheetOpen(!sheetOpen)}>
              <SheetTrigger asChild onClick={() => setSheetOpen(true)}>
                <Menu className='ms-[24px] cursor-pointer' />
              </SheetTrigger>
              <SheetContent side='left' className='w-fit p-0 [&>button[type=button]]:hidden'>
                <SheetHeader>
                  <SheetTitle className='text-center' />
                  <SheetDescription />
                </SheetHeader>
                <div className='!shadow-main relative flex flex-1 items-center px-[12px]'>
                  <img src='icons/search.svg' alt='' className='absolute left-[24px]' />
                  <Input
                    placeholder='Filter sessions'
                    onChange={(e) => setFilterSessionVal(e.target.value)}
                    className='!ring-0 !ring-offset-0 !pointer-events-auto h-[38px] w-full rounded-[6px] ps-[35px] placeholder:font-light'
                  />
                </div>
                <SessionList filterSessionVal={filterSessionVal} />
              </SheetContent>
            </Sheet>
          </div>
        </div>
        <a
          href='https://parlant.io'
          target='_blank'
          className='-me-[6px] ms-[4px] flex items-center max-mobile:hidden'
          rel='noopener'
        >
          <img src='/chat/app-logo.svg' alt='logo' aria-hidden className='h-[30px] self-center' />
        </a>
        <div className='!shadow-main relative flex flex-1 items-center ps-[12px] max-mobile:hidden'>
          <img src='icons/search.svg' alt='' className='absolute left-[24px]' />
          <Input
            placeholder='Filter sessions'
            onChange={(e) => setFilterSessionVal(e.target.value)}
            className='!ring-0 !ring-offset-0 !pointer-events-auto h-[38px] w-full rounded-[6px] ps-[35px] placeholder:font-light'
          />
        </div>
        <div className='group ms-[8px]'>
          <Tooltip value='New Session' side='right' className='group'>
            <>
              <img
                src='buttons/new-session.svg'
                alt='add session'
                className='cursor-pointer shadow-main group-hover:hidden'
                onKeyDown={spaceClick}
                onClick={createNewSession}
              />
              <img
                src='buttons/new-session-hover.svg'
                alt='add session'
                className='hidden cursor-pointer shadow-main group-hover:block'
                onKeyDown={spaceClick}
                onClick={createNewSession}
              />
            </>
          </Tooltip>
        </div>
      </div>
      {/* <div className='w-[352px] h-[70px] flex items-center justify-end me-4'>
                <DarkModeToggle/>
            </div> */}
    </HeaderWrapper>
  )
}

export default ChatHeader
