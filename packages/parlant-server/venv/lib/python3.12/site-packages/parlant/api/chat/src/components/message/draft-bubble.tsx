import { useEffect, useState } from 'react'
import { twMerge } from 'tailwind-merge'
import { copy } from '@/lib/utils'
import Markdown from '../markdown/markdown'
import Tooltip from '../ui/custom/tooltip'

const DraftBubble = ({ draft = '', open = false }) => {
  const [wasOpen, setWasOpen] = useState(false)

  useEffect(() => {
    if (open) setWasOpen(true)
  }, [open])

  return (
    <div
      className={twMerge(
        'group/main !origin-top flex min-w-full overflow-hidden',
        !open && !wasOpen && 'h-0 opacity-0',
        open ? 'animate-slide-down' : wasOpen ? 'animate-slide-up' : ''
      )}
    >
      <div className='peer/draft relative mb-[16px] min-w-[min(560px,100%)] max-w-[min(560px,calc(100%-30px))] rounded-[22px] bg-[#F5F6F8] px-[22px] py-[20px] text-gray-400'>
        <Markdown className='leading-[26px]'>{draft}</Markdown>
      </div>
      <div
        className={twMerge(
          'invisible relative mx-[10px] flex items-center self-stretch hover:visible group-hover/main:visible peer-hover:visible'
        )}
      >
        <Tooltip value='Copy' side='top'>
          <div
            data-testid='copy-button'
            role='button'
            onClick={() => copy(draft || '')}
            className='group cursor-pointer'
          >
            <img
              src='icons/copy.svg'
              alt='edit'
              className='block size-[30px] rounded-[10px] p-[5px] opacity-50 group-hover:bg-[#EBECF0]'
            />
          </div>
        </Tooltip>
      </div>
    </div>
  )
}

export default DraftBubble
